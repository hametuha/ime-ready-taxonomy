!function(t){function e(t){return String(null===t||void 0===t?"":t)}function n(t){return e(t).replace(d,function(t){return l[t]})}var a={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:n(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:n(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},s={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},d=/[&<>"'\/]/g,r={init:function(e,n){var s=t.extend({},a,n||{});return this.each(function(){t(this).data("settings",s),t(this).data("tokenInputObject",new t.TokenList(this,e,s))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(e){return t(this).data("settings",t.extend({},t(this).data("settings"),e||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var t=this,e=this.parent();return e.empty(),t.show(),e.append(t),t}}};t.fn.tokenInput=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):r.init.apply(this,arguments)},t.TokenList=function(e,a,l){function d(a){return t(e).data("settings").enableHTML?a:n(a)}function r(n){t(e).data("settings").disabled="boolean"==typeof n?n:!t(e).data("settings").disabled,z.attr("disabled",t(e).data("settings").disabled),q.toggleClass(t(e).data("settings").classes.disabled,t(e).data("settings").disabled),U&&m(t(U),i.END),G.attr("disabled",t(e).data("settings").disabled)}function u(){return null!==t(e).data("settings").tokenLimit&&M>=t(e).data("settings").tokenLimit?(z.hide(),void C()):void 0}function c(){if(_!==(_=z.val())){var t=q.width()-z.offset().left-q.offset().left;Q.html(n(_)||n(l.placeholder)),z.width(Math.min(q.width(),Math.max(t,Q.width()+30)))}}function g(t){return t>=48&&90>=t||t>=96&&111>=t||t>=186&&192>=t||t>=219&&222>=t}function p(){var n=t.trim(z.val()),a=n.split(t(e).data("settings").tokenDelimiter);t.each(a,function(n,a){if(a){t.isFunction(t(e).data("settings").onFreeTaggingAdd)&&(a=t(e).data("settings").onFreeTaggingAdd.call(G,a));var s={};s[t(e).data("settings").tokenValue]=s[t(e).data("settings").propertyToSearch]=a,f(s)}})}function h(n){var a=t(t(e).data("settings").tokenFormatter(n)),s=n.readonly===!0?!0:!1;s&&a.addClass(t(e).data("settings").classes.tokenReadOnly),a.addClass(t(e).data("settings").classes.token).insertBefore(K),s||t("<span>"+t(e).data("settings").deleteText+"</span>").addClass(t(e).data("settings").classes.tokenDelete).appendTo(a).click(function(){return t(e).data("settings").disabled?void 0:(v(t(this).parent()),G.change(),!1)});var i=n;return t.data(a.get(0),"tokeninput",n),N=N.slice(0,W).concat([i]).concat(N.slice(W)),W++,y(N,G),M+=1,null!==t(e).data("settings").tokenLimit&&M>=t(e).data("settings").tokenLimit&&(z.hide(),C()),a}function f(n){var a=t(e).data("settings").onAdd;if(M>0&&t(e).data("settings").preventDuplicates){var s=null;if(q.children().each(function(){var e=t(this),a=t.data(e.get(0),"tokeninput");return a&&a[l.tokenValue]===n[l.tokenValue]?(s=e,!1):void 0}),s)return k(s),K.insertAfter(s),void S(z)}z.width(0),(null==t(e).data("settings").tokenLimit||M<t(e).data("settings").tokenLimit)&&(h(n),z.attr("placeholder",null),u()),z.val(""),C(),t.isFunction(a)&&a.call(G,n)}function k(n){t(e).data("settings").disabled||(n.addClass(t(e).data("settings").classes.selectedToken),U=n.get(0),z.val(""),C())}function m(n,a){n.removeClass(t(e).data("settings").classes.selectedToken),U=null,a===i.BEFORE?(K.insertBefore(n),W--):a===i.AFTER?(K.insertAfter(n),W++):(K.appendTo(q),W=M),S(z)}function T(e){var n=U;U&&m(t(U),i.END),n===e.get(0)?m(e,i.END):k(e)}function v(n){var a=t.data(n.get(0),"tokeninput"),s=t(e).data("settings").onDelete,i=n.prevAll().length;i>W&&i--,n.remove(),U=null,S(z),N=N.slice(0,i).concat(N.slice(i+1)),0==N.length&&z.attr("placeholder",l.placeholder),W>i&&W--,y(N,G),M-=1,null!==t(e).data("settings").tokenLimit&&(z.show().val(""),S(z)),t.isFunction(s)&&s.call(G,a)}function y(n,a){var s=t.map(n,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});a.val(s.join(t(e).data("settings").tokenDelimiter))}function C(){$.hide().empty(),V=null}function b(){$.css({position:"absolute",top:q.offset().top+q.outerHeight(),left:q.offset().left,width:q.width(),"z-index":t(e).data("settings").zindex}).show()}function w(){t(e).data("settings").searchingText&&($.html("<p>"+d(t(e).data("settings").searchingText)+"</p>"),b())}function E(){t(e).data("settings").hintText&&($.html("<p>"+d(t(e).data("settings").hintText)+"</p>"),b())}function D(t){return t.replace(X,"\\$&")}function R(t,e){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+D(e)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+d(e)+"</b>"})}function x(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+D(e)+")(?![^<>]*>)(?![^&;]+;)","g"),R(e,n))}function F(n,a){if(a&&a.length){$.empty();var s=t("<ul>").appendTo($).mouseover(function(e){L(t(e.target).closest("li"))}).mousedown(function(e){return f(t(e.target).closest("li").data("tokeninput")),G.change(),!1}).hide();t(e).data("settings").resultsLimit&&a.length>t(e).data("settings").resultsLimit&&(a=a.slice(0,t(e).data("settings").resultsLimit)),t.each(a,function(a,i){var o=t(e).data("settings").resultsFormatter(i);o=x(o,i[t(e).data("settings").propertyToSearch],n),o=t(o).appendTo(s),o.addClass(a%2?t(e).data("settings").classes.dropdownItem:t(e).data("settings").classes.dropdownItem2),0===a&&L(o),t.data(o.get(0),"tokeninput",i)}),b(),t(e).data("settings").animateDropdown?s.slideDown("fast"):s.show()}else t(e).data("settings").noResultsText&&($.html("<p>"+d(t(e).data("settings").noResultsText)+"</p>"),b())}function L(n){n&&(V&&A(t(V)),n.addClass(t(e).data("settings").classes.selectedDropdownItem),V=n.get(0))}function A(n){n.removeClass(t(e).data("settings").classes.selectedDropdownItem),V=null}function O(){var n=z.val();n&&n.length&&(U&&m(t(U),i.AFTER),n.length>=t(e).data("settings").minChars?(w(),clearTimeout(B),B=setTimeout(function(){P(n)},t(e).data("settings").searchDelay)):C())}function P(n){var a=n+I(),s=H.get(a);if(s)t.isFunction(t(e).data("settings").onCachedResult)&&(s=t(e).data("settings").onCachedResult.call(G,s)),F(n,s);else if(t(e).data("settings").url){var i=I(),o={};if(o.data={},i.indexOf("?")>-1){var d=i.split("?");o.url=d[0];var r=d[1].split("&");t.each(r,function(t,e){var n=e.split("=");o.data[n[0]]=n[1]})}else o.url=i;o.data[t(e).data("settings").queryParam]=n,o.type=t(e).data("settings").method,o.dataType=t(e).data("settings").contentType,t(e).data("settings").crossDomain&&(o.dataType="jsonp"),o.success=function(s){H.add(a,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s),t.isFunction(t(e).data("settings").onResult)&&(s=t(e).data("settings").onResult.call(G,s)),z.val()===n&&F(n,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s)},l.onSend&&l.onSend(o),t.ajax(o)}else if(t(e).data("settings").local_data){var u=t.grep(t(e).data("settings").local_data,function(a){return a[t(e).data("settings").propertyToSearch].toLowerCase().indexOf(n.toLowerCase())>-1});H.add(a,u),t.isFunction(t(e).data("settings").onResult)&&(u=t(e).data("settings").onResult.call(G,u)),F(n,u)}}function I(){var n=t(e).data("settings").url;return"function"==typeof t(e).data("settings").url&&(n=t(e).data("settings").url.call(t(e).data("settings"))),n}function S(t){setTimeout(function(){t.focus()},50)}if("string"===t.type(a)||"function"===t.type(a)){t(e).data("settings").url=a;var j=I();void 0===t(e).data("settings").crossDomain&&"string"==typeof j&&(t(e).data("settings").crossDomain=-1===j.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==j.split(/\/+/g)[1])}else"object"==typeof a&&(t(e).data("settings").local_data=a);t(e).data("settings").classes?t(e).data("settings").classes=t.extend({},s,t(e).data("settings").classes):t(e).data("settings").theme?(t(e).data("settings").classes={},t.each(s,function(n,a){t(e).data("settings").classes[n]=a+"-"+t(e).data("settings").theme})):t(e).data("settings").classes=s;var N=[],M=0,H=new t.TokenList.Cache,B,_,z=t('<input type="text"  autocomplete="off" autocapitalize="off">').css({outline:"none"}).attr("id",t(e).data("settings").idPrefix+e.id).focus(function(){return t(e).data("settings").disabled?!1:((null===t(e).data("settings").tokenLimit||t(e).data("settings").tokenLimit!==M)&&E(),void q.addClass(t(e).data("settings").classes.focused))}).blur(function(){C(),t(e).data("settings").allowFreeTagging&&p(),t(this).val(""),q.removeClass(t(e).data("settings").classes.focused)}).bind("keyup keydown blur update",c).keyup(function(t){switch(t.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:break;default:setTimeout(function(){O()},5)}}).keydown(function(n){var a,s;switch(n.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if(t(this).val()){var l=null;l=n.keyCode===o.DOWN||n.keyCode===o.RIGHT?t(V).next():t(V).prev(),l.length&&L(l)}else a=K.prev(),s=K.next(),a.length&&a.get(0)===U||s.length&&s.get(0)===U?n.keyCode===o.LEFT||n.keyCode===o.UP?m(t(U),i.BEFORE):m(t(U),i.AFTER):n.keyCode!==o.LEFT&&n.keyCode!==o.UP||!a.length?n.keyCode!==o.RIGHT&&n.keyCode!==o.DOWN||!s.length||k(t(s.get(0))):k(t(a.get(0)));return!1;break;case o.BACKSPACE:if(a=K.prev(),!t(this).val().length)return U?(v(t(U)),G.change()):a.length&&k(t(a.get(0))),!1;1===t(this).val().length?C():setTimeout(function(){O()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:if(V)f(t(V).data("tokeninput")),G.change();else{if(t(e).data("settings").allowFreeTagging){if(t(e).data("settings").allowTabOut&&""===t(this).val())return!0;p()}else if(t(this).val(""),t(e).data("settings").allowTabOut)return!0;n.stopPropagation(),n.preventDefault()}return!1;case o.ESCAPE:return C(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){O()},5)}});l.placeholder&&z.attr("placeholder",l.placeholder);var G=t(e).hide().val("").focus(function(){S(z)}).blur(function(){return z.blur(),G}),U=null,W=0,V=null,q=t("<ul />").addClass(t(e).data("settings").classes.tokenList).click(function(e){var n=t(e.target).closest("li");n&&n.get(0)&&t.data(n.get(0),"tokeninput")?T(n):(U&&m(t(U),i.END),S(z))}).mouseover(function(n){var a=t(n.target).closest("li");a&&U!==this&&a.addClass(t(e).data("settings").classes.highlightedToken)}).mouseout(function(n){var a=t(n.target).closest("li");a&&U!==this&&a.removeClass(t(e).data("settings").classes.highlightedToken)}).insertBefore(G),K=t("<li />").addClass(t(e).data("settings").classes.inputToken).appendTo(q).append(z),$=t("<div>").addClass(t(e).data("settings").classes.dropdown).appendTo("body").hide(),Q=t("<tester/>").insertAfter(z).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:z.css("fontSize"),fontFamily:z.css("fontFamily"),fontWeight:z.css("fontWeight"),letterSpacing:z.css("letterSpacing"),whiteSpace:"nowrap"});G.val("");var J=t(e).data("settings").prePopulate||G.data("pre");t(e).data("settings").processPrePopulate&&t.isFunction(t(e).data("settings").onResult)&&(J=t(e).data("settings").onResult.call(G,J)),J&&J.length&&t.each(J,function(t,e){h(e),u(),z.attr("placeholder",null)}),t(e).data("settings").disabled&&r(!0),t.isFunction(t(e).data("settings").onReady)&&t(e).data("settings").onReady.call(),this.clear=function(){q.children("li").each(function(){0===t(this).children("input").length&&v(t(this))})},this.add=function(t){f(t)},this.remove=function(e){q.children("li").each(function(){if(0===t(this).children("input").length){var n=t(this).data("tokeninput"),a=!0;for(var s in e)if(e[s]!==n[s]){a=!1;break}a&&v(t(this))}})},this.getTokens=function(){return N},this.toggleDisabled=function(t){r(t)},c();var X=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(e){var n=t.extend({max_size:500},e),a={},s=0,i=function(){a={},s=0};this.add=function(t,e){s>n.max_size&&i(),a[t]||(s+=1),a[t]=e},this.get=function(t){return a[t]}}}(jQuery);